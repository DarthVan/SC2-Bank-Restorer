/*!
 * sc2-bank-generator v.1.0.8
 *
 * Compiled from:
 *
 * sc2-bank-generator/src/core/sc2/index.ts
 * sc2-bank-generator/src/utils/sha1.ts
 * sc2-bank-generator/src/core/bank/bank.ts
 * sc2-bank-generator/src/core/bank/bank-info.ts
 * sc2-bank-generator/src/core/bank/bank-key.ts
 * sc2-bank-generator/src/core/bank/bank-map.ts
 * sc2-bank-generator/src/core/bank/index.ts
 *
 * Ð¡ompiled on Thu, 24 Aug 2023 10:33:31 UTC
 */function O(r,t){return E(Math.pow(r,t))}function R(r){return E(Math.pow(E(r%1048576),.5))}function j(r,t){return E(r/t)}function k(r,t){return E(r%t)}function F(r,t=4){let e=1;for(;t-- >0;)e*=10;return(Math.floor(r*e+.1)/e).toString()}function E(r){return V(r,4096)}function V(r,t=4096){return Math.floor(r*t)/t}const T=Math.pow(2,24),U=Math.pow(2,32);function y(r){let t="";for(let e=7;e>=0;--e){const s=r>>>(e<<2)&15;t+=s.toString(16)}return t}function B(r,t){return r<<t|r>>>32-t}class X{constructor(t){this.bytes=new Uint8Array(t<<2)}get(t){return t<<=2,this.bytes[t]*T+(this.bytes[t+1]<<16|this.bytes[t+2]<<8|this.bytes[t+3])}set(t,e){const s=Math.floor(e/T),n=e-s*T;t<<=2,this.bytes[t]=s,this.bytes[t+1]=n>>16,this.bytes[t+2]=n>>8&255,this.bytes[t+3]=n&255}}function G(r){r=r.replace(/[\u0080-\u07ff]/g,function(s){const n=s.charCodeAt(0);return String.fromCharCode(192|n>>6,128|n&63)}),r=r.replace(/[\u0080-\uffff]/g,function(s){const n=s.charCodeAt(0);return String.fromCharCode(224|n>>12,128|n>>6&63,128|n&63)});const t=r.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=r.charCodeAt(s);return e.buffer}function K(r){let t;r instanceof ArrayBuffer?t=r:t=G(String(r));const e=t.byteLength,s=e<<3,n=s+65,_=Math.ceil(n/512)<<9>>>3>>>2,l=new X(_),m=l.bytes,o=new Uint32Array(80),A=new Uint8Array(t);let p=1732584193,N=4023233417,v=2562383102,S=271733878,C=3285377520,c,i;for(c=0;c<e;++c)m[c]=A[c];for(m[e]=128,l.set(_-2,Math.floor(s/U)),l.set(_-1,s&4294967295),c=0;c<_;c+=16){for(i=0;i<16;++i)o[i]=l.get(c+i);for(;i<80;++i)o[i]=B(o[i-3]^o[i-8]^o[i-14]^o[i-16],1);let M=p,h=N,f=v,g=S,D=C,d,b,x;for(i=0;i<80;++i)i<20?(d=h&f|~h&g,b=1518500249):i<40?(d=h^f^g,b=1859775393):i<60?(d=h&f^h&g^f&g,b=2400959708):(d=h^f^g,b=3395469782),x=B(M,5)+d+D+b+o[i]&4294967295,D=g,g=f,f=B(h,30),h=M,M=x;p=p+M&4294967295,N=N+h&4294967295,v=v+f&4294967295,S=S+g&4294967295,C=C+D&4294967295}return y(p)+y(N)+y(v)+y(S)+y(C)}class q{constructor(t,e,s,n){this._info=new L(t,e,s),this._version=n||"1",this.init()}parse(t){let e=null;const s=new DOMParser;try{if(typeof t=="string")e=s.parseFromString(t,"text/xml").firstElementChild;else throw new Error("Received data is not valid xml!")}catch{throw new Error("Received data is not valid xml!")}if(e==null)return;this._version=e.getAttribute("version"),e.firstChild.nodeName=="Bank"&&(e=e.firstElementChild),this._sections.clear();const n=e.getElementsByTagName("Section");for(let a=0;a<n.length;a++){const I=new w(n[a].getAttribute("name")),_=n[a].getElementsByTagName("Key");for(let l=0;l<_.length;l++){const m=_[l],o=m.getAttribute("name"),A=m.firstElementChild.attributes.item(0).name,p=m.firstElementChild.getAttribute(A);I.set(o,new P(o,A,p))}this._sections.set(I.name,I)}this._signature=null;try{this._signature=e.getElementsByTagName("Signature")[0].getAttribute("value")}catch{this._signature=null}}addSection(t){return this._sections.has(t)||this._sections.set(t,new w(t)),this._sections.get(t)}addKey(t,e,s,n){const a=this.addSection(n);switch(typeof s){case"boolean":s=s?"1":"0";break;case"number":s=s.toString();break;case"string":break;case"object":e=="POINT"&&(s=F(s.x)+","+F(s.y));break}return a.has(t)?a.get(t).update(s):a.set(t,new P(t,u[e],s)),a.get(t)}getKey(t,e){return this._sections.has(e)?this._sections.get(e).get(t):null}removeSection(t){return this._sections.delete(t)}removeKey(t,e){return this._sections.has(e)?this._sections.get(e).delete(t):!1}sort(){this._sections.forEach(t=>{this._sections.set(t.name,t.sort(),!0)}),this._sections=this._sections.sort()}getAsString(){let t=`<?xml version="1.0" encoding="utf-8"?>
<Bank version="`+this._version+`">
`;return this._sections.forEach(e=>{t+='	<Section name="'+e.name+`">
`,e.forEach(s=>{t+='		<Key name="'+s.name+`">
`,t+="			<Value "+s.type+'="'+s.stringValue+`"/>
`,t+=`		</Key>
`}),t+=`	</Section>
`}),this._signature&&(t+='	<Signature value="'+this._signature+`"/>
`),t+="</Bank>",t}updateSignature(){let t="";return t+=this._info.authorID,t+=this._info.playerID,t+=this._info.bankName,this._sections.forEach(e=>{t+=e.name,e.forEach(s=>{t+=s.name,t+="Value",t+=s.type,s.type!=u.TEXT&&(t+=s.stringValue)})}),this._signature=K(t).toUpperCase()}async openFile(t,e){const s=new XMLHttpRequest;s.onreadystatechange=()=>{s.readyState==4&&s.status==200&&(this.parse.call(this,s.response),e&&e())},s.open("GET",t,!0),s.send()}get info(){return this._info}get sections(){return this._sections}get signature(){return this._signature}get version(){return this._version}init(){this._sections=new w("Sections")}}class L{constructor(t,e,s){this._bankName=t,this._authorID=e,this._playerID=s}getAuthorNumber(){return parseInt(this._authorID.split("-")[3])}getPlayerNumber(){return parseInt(this._playerID.split("-")[3])}get bankName(){return this._bankName}get authorID(){return this._authorID}get playerID(){return this._playerID}}class P{constructor(t,e,s){this._name=t,this._type=e,this._value=s}update(t){this._value=t}get name(){return this._name}get type(){return this._type}get value(){switch(this._type){case u.STRING:return this._value;case u.TEXT:return this._value;case u.INT:return parseInt(this._value);case u.FLAG:return this._value=="1";case u.FIXED:return parseFloat(this._value);case u.POINT:const t=this._value.split(",");return{x:parseFloat(t[0]),y:parseFloat(t[1])}}return null}get stringValue(){return this._value}}class w extends Map{constructor(t,e){super(e),this._name=t}set(t,e,s=!1){return s||this.isValidName(e.name,t),super.set(t,e)}sort(){const t=new Intl.Collator("en",{numeric:!0,sensitivity:"base"});return new w(this._name,[...this.entries()].sort((e,s)=>t.compare(e[0],s[0])))}clear(){super.clear()}get name(){return this._name}isValidName(t,e){if(e&&e!=t)throw new Error("BankMap: Error! Key "+e+" and BankName are different!");return this.forEach((s,n)=>{if(n==t)throw new Error("BankMap: Error! Name "+t+" already used!")}),!0}}var u=(r=>(r.INT="int",r.FIXED="fixed",r.STRING="string",r.FLAG="flag",r.TEXT="text",r.POINT="point",r))(u||{});export{q as B,R as a,F as b,j as c,O as d,k as s};
